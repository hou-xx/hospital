<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>
    <title>设备调配 > 调配申请</title>

    <link rel="stylesheet" type="text/css" href="/static/admin/layui/css/layui.css">
    <link rel="stylesheet" type="text/css" href="/static/admin/css/admin.css">
    <script type="text/javascript" src="/static/admin/js/jquery-3.3.1.min.js"></script>
    <!--[if IE 8]>
    <script type="text/javascript" src="/static/admin/js/jquery-1.11.3.min.js"></script>
    <![endif]-->
    <script type="text/javascript" src="/static/admin/js/basic.js"></script>
    <style>
        .layui-form-label {
            width: 145px !important;
        }

        .layui-input-block {
            margin-left: 145px !important;
        }

        .layui-form-text .layui-form-label {
            width: 100% !important;
        }

        .layui-form-text .layui-input-block {
            margin-left: 0 !important;
        }

    </style>
</head>
<body>
<div class="layui-row">
    <div class="col-xs-12">
        <div class="layui-col-md12">
            <div class="layui-tab">
                <div class="layui-tab-content">
                    <form class="layui-form layui-form-pane" action="">
                        <div class="layui-collapse">
                            <div class="layui-row layui-col-space20">
                                <div class="layui-col-md6 layui-col-space20" style="margin-top: 20px;margin-left: 10px">

                                    <!--                            装备编码-->
                                    <!-- <div class="layui-form-item " >
                                         <label class="layui-form-label">装备编码<span class="sign">*</span></label>
                                         <div class="layui-input-block">
                                             <input type="text" name="eqZbbm" id="eqZbbm"
                                                    placeholder="请输入内容" onfocus="this.placeholder=''"
                                                    onblur="this.placeholder='请输入内容'"
                                                    autocomplete="off" class="layui-input" >
                                         </div>
                                     </div>-->
                                    <!--                            装备数量-->
                                    <div class="layui-form-item ">
                                        <label class="layui-form-label">装备数量<span class="sign">*</span></label>
                                        <div class="layui-input-block">
                                            <input type="text" name="eqCount" id="eqCount"
                                                   placeholder="请输入内容" onfocus="this.placeholder=''"
                                                   onblur="this.placeholder='请输入内容'"
                                                   autocomplete="off" class="layui-input">
                                        </div>
                                    </div>
                                    <!--                           归还日期-->
                                    <div class="layui-form-item">
                                        <label class="layui-form-label">归还日期<span class="sign">*</span></label>
                                        <div class="layui-input-block">
                                            <input type="text" name="eqGhrq" id="date1" placeholder=""
                                                   autocomplete="off" class="layui-input">
                                        </div>
                                    </div>
                                    <!--                    装备检查-->
                                    <div class="layui-form-item">
                                        <label class="layui-form-label">装备检查<span class="sign">*</span></label>
                                        <div class="layui-input-block">
                                            <input name="eqZbjc" placeholder="请输入内容" onfocus="this.placeholder=''"
                                                   onblur="this.placeholder='请输入内容'"
                                                   autocomplete="off" class="layui-input">
                                        </div>
                                    </div>
                                    <!--                            归还科室-->
                                    <div class="layui-form-item ">
                                        <label class="layui-form-label">归还科室<span class="sign">*</span></label>
                                        <div class="layui-input-block">
                                            <input type="text" name="eqGhks" id="eqGhks"
                                                   placeholder="请输入内容" onfocus="this.placeholder=''"
                                                   onblur="this.placeholder='请输入内容'"
                                                   autocomplete="off" class="layui-input">
                                        </div>
                                    </div>
                                    <!--                                    装备调出签字图片-->
                                    <input type="hidden" name="eqDrurl" value="" id="eqDrurl">
                                    <div id="yc">
                                        <div class="layui-form-item" pane>
                                            <label class="layui-form-label">装备调出签字图片</label>
                                            <div class="layui-input-block">
                                                <button type="button" class="layui-btn layui-btn-sm layui-btn-normal"
                                                        id="sbzp">选择文件
                                                </button>
                                                <button type="button" class="layui-btn layui-btn-sm layui-btn-normal"
                                                        id="sbzp_sub">上传文件
                                                </button>
                                            </div>
                                        </div>
                                        <div class="layui-upload-list">
                                            <table class="layui-table">
                                                <thead>
                                                <tr>
                                                    <th>文件名</th>
                                                    <th>大小</th>
                                                    <th>状态</th>
                                                    <th>操作</th>
                                                </tr>
                                                </thead>
                                                <tbody id="demoList"></tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>

                                <div class="layui-col-md6 layui-col-space20" style="margin-top: 20px;">
                                    <!--                            接收科室-->
                                    <div class="layui-form-item ">
                                        <label class="layui-form-label">接收科室<span class="sign">*</span></label>
                                        <div class="layui-input-block">
                                            <input type="text" name="eqJsks" id="eqJsks"
                                                   placeholder="请输入内容" onfocus="this.placeholder=''"
                                                   onblur="this.placeholder='请输入内容'"
                                                   autocomplete="off" class="layui-input">
                                        </div>
                                    </div>
                                    <!--                            归还经办人-->
                                    <div class="layui-form-item ">
                                        <label class="layui-form-label">归还经办人<span class="sign">*</span></label>
                                        <div class="layui-input-block">
                                            <input type="text" name="eqGhjbr" id="eqGhjbr"
                                                   placeholder="请输入内容" onfocus="this.placeholder=''"
                                                   onblur="this.placeholder='请输入内容'"
                                                   autocomplete="off" class="layui-input">
                                        </div>
                                    </div>
                                    <!--                            接收经办人-->
                                    <div class="layui-form-item ">
                                        <label class="layui-form-label">接收经办人<span class="sign">*</span></label>
                                        <div class="layui-input-block">
                                            <input type="text" name="eqJsjbr" id="eqJsjbr"
                                                   placeholder="请输入内容" onfocus="this.placeholder=''"
                                                   onblur="this.placeholder='请输入内容'"
                                                   autocomplete="off" class="layui-input">
                                        </div>
                                    </div>
                                    <!--                            调剂交接id-->
                                    <div class="layui-form-item ">
                                        <label class="layui-form-label">调剂交接id<span class="sign">*</span></label>
                                        <div class="layui-input-block">
                                            <input type="text" name="eqDpjjid" id="eqDpjjid"
                                                   placeholder="请输入内容" onfocus="this.placeholder=''"
                                                   onblur="this.placeholder='请输入内容'"
                                                   autocomplete="off" class="layui-input">
                                        </div>
                                    </div>
                                    <!--            归还类型-->
                                    <input type="hidden" name="eqGhlx" id="eqGhlx" value="0">
                                    <!--                                    装备调入签字图片-->
                                    <input type="hidden" name="tjjjDrurl" value="" id="tjjjDrurl">
                                    <div id="yc1">
                                        <div class="layui-form-item" pane>
                                            <label class="layui-form-label">装备调入签字图片</label>
                                            <div class="layui-input-block">
                                                <button type="button" class="layui-btn layui-btn-sm layui-btn-normal"
                                                        id="sbzp1">选择文件
                                                </button>
                                                <button type="button" class="layui-btn layui-btn-sm layui-btn-normal"
                                                        id="sbzp_sub1">上传文件
                                                </button>
                                            </div>
                                        </div>
                                        <div class="layui-upload-list">
                                            <table class="layui-table">
                                                <thead>
                                                <tr>
                                                    <th>文件名</th>
                                                    <th>大小</th>
                                                    <th>状态</th>
                                                    <th>操作</th>
                                                </tr>
                                                </thead>
                                                <tbody id="demoList1"></tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                        <div class="layui-col-md12 layui-col-space20">
                            <!--                                    展示的数据-->
                            <div class="layui-form-item" pane style="margin-bottom:-10px;">
                                <label class="layui-form-label ">装备<span class="sign">*</span></label>
                                <div class="layui-input-block">
                                    <button class="layui-btn layui-btn-sm addNew" data-id="table"
                                            id="dataTable1" style="background-color: #003366"><i class="fas fa-plus"></i>&nbsp;添加
                                    </button>
                                    <button class="layui-btn layui-btn-danger layui-btn-sm delNew" data-id="table">
                                        <i class="fas fa-trash-alt" style="background-color: #cc0033"></i>&nbsp;删除
                                    </button>
                                </div>
                            </div>
                            <table id="table" lay-filter="table1"></table>
                        </div>
                        <!--                                        保存-->
                        <div class="col-xs-12">
                            <div class="layui-form-item">
                                <button class="warm_btn layui-btn layui-btn-warm layui-btn-fluid" lay-submit=""
                                        lay-filter="save">保存
                                </button>
                            </div>
                        </div>
                    </form>


                </div>

            </div>
        </div>
    </div>
</div>

<script>
    var da = [];
    formData = {};
    formData.count1 = 0;
    formData.eqSbzp = [];
    formData1 = {};
    formData1.count1 = 0;
    formData1.eqSbzp = [];
    var formData2 = {};
    renderMod = {
        addTable: {
            table: [
                {
                    // elem: "#table",
                    cols: [[ //表头
                        {type: "checkbox"},
                        {field: 'eqName', title: '设备名称'},
                        {field: 'eqGg', title: '规格'},
                        {field: 'eqXh', title: '型号'},
                        {field: 'eqSbbh', title: '设备编号'},
                        {field: 'tjjjDrks', title: '调入科室'},
                        {field: 'drksName', title: '调入科室人'},
                        {field: 'tjjjDcks', title: '调出科室'},
                        {field: 'dcksName', title: '调出科室人'}
                    ]]
                    , toolbar: false
                    , page: false
                    , height: "200"
                    , data: []
                    , text: {
                        none: "请点击上方按钮添加数据！"
                    }
                }
            ]

        },
        form: {
            val: {
                select: [
                    {
                        filter: "matching",
                        ids: "bm_id",
                        text: "bm_name",
                        url: "/lifeManage/selectAllBmIdAndName"
                    }
                ]
            },
            submit: {
                before: function (param) {
                    /*var xx=formData2.radio[0].eqSbbh;
                    console.log(xx);
                    var yy=formData2.radio[0].eqName;
                    var b=[{"sbbh":xx,"name":yy,"count":"1"}];*/
                    // console.log(da);
                    var tv = getTableValue("table");
                    if (doJudg({
                        // "undefined": [formData2.radio]
                        0: [tv]
                    })) {
                        putMsg({
                            alert: "无法提交空数据！"
                        });
                        return false;
                    }
                    return param = {
                        1: tv
                    };
                    // console.log(formData2);
                },
                form: {
                    url: "/lifeManage/insertTjjj",
                    type: "POST",
                    data: ["tjjjDrks", "tjjjDcks", "tjjjDrjbr", "tjjjDcjbr", "tjjjJllx", "tjjjJsrq", "tjjjDpgc"
                        , "tjjjDpsc", "tjjjJsfztjc", "tjjjJsffjjc", "tjjjDcurl", "tjjjDrurl", "tjjjDpffjjc", "tjjjDpfztjc", "tjjjTpsj"],
                    contentType: "application/json",
                    // dataType: "json",
                    param: {1: "listsbgh"},
                    reload: "parent"
                    , done: function () {
                        console.log(111);
                    }
                }
            },
            date: [
                {
                    elem: "#date1",
                    value: today0,
                    type: "date",
                    format: 'yyyy-MM-dd'
                }, ,
                {
                    elem: "#date2",
                    value: today0,
                    type: "date",
                    format: 'yyyy-MM-dd'
                }
            ],
            file: [
                {
                    elem: "#sbzp",
                    url: "/lifeManage/importdjhwimgurls",
                    accept: "images",
                    acceptMime: "image/*",
                    multiple: true,
                    auto: false,
                    bindAction: "#sbzp_sub",
                    number: 6,
                    field: "imgs",
                    choose: function (obj) {
                        if (formData.count1 >= 6) {
                            putMsg({
                                alert: "最多只能上传6张图！"
                            });
                            return false;
                        }
                        var files = this.files = obj.pushFile();
                        obj.preview(function (index, file, result) {
                            var tr = $(['<tr id="upload-' + index + '">'
                                , '<td>' + file.name + '</td>'
                                , '<td>' + (file.size / 1014).toFixed(1) + 'kb</td>'
                                , '<td>等待上传</td>'
                                , '<td>'
                                , '<button class="layui-btn layui-btn-xs demo-see" data-img="' + result + '">查看</button>'
                                , '<button class="layui-btn layui-btn-xs layui-btn-danger demo-delete">删除</button>'
                                , '</td>'
                                , '</tr>'].join(''));

                            //查看
                            tr.find('.demo-see').on('click', function () {
                                layOpen({
                                    type: 1,
                                    content: "<img src='" + $(this).attr("data-img") + "' style='width:100%;' />",
                                    area: ["80%", "80%"]
                                });
                                return false;
                            });

                            //删除
                            tr.find('.demo-delete').on('click', function () {
                                layer.confirm("确认删除这张图吗？", function (index) {
                                    delete files[index]; //删除对应的文件
                                    tr.remove();
                                    var inp = $("#sbzp").next().val("");
                                    formData.count1--;
                                    layer.close(index);
                                });
                                return false;
                            });

                            $("#demoList").append(tr);
                            formData.count1++;
                        });
                    }, done: function (res, index, upload) {
                        if (res.code === 0) {
                            formData.eqSbzp.push(res.data);
                            var tr = $("#demoList").find('tr#upload-' + index)
                                , tds = tr.children();
                            tds.eq(2).html('<span style="color: #5FB878;">上传成功</span>');
                            tds.eq(3).html(''); //清空操作
                            $("#tjjjDcurl").val($("#tjjjDcurl").val() + res.data);
                            console.log($("#tjjjDcurl").val())
                            return delete this.files[index]; //删除文件队列已经上传成功的文件
                        }
                        this.error(index, upload);
                    }, error: function (index, upload) {
                        var tr = $("#demoList").find('tr#upload-' + index)
                            , tds = tr.children();
                        tds.eq(2).html('<span style="color: #FF5722;">上传失败</span>');
                        console.log("index:" + index);
                        console.log("upload" + upload);
                    }
                },
                {
                    elem: "#sbzp1",
                    url: "/lifeManage/importdjhwimgurls",
                    accept: "images",
                    acceptMime: "image/*",
                    multiple: true,
                    auto: false,
                    bindAction: "#sbzp_sub1",
                    number: 6,
                    field: "imgs",
                    choose: function (obj) {
                        if (formData1.count1 >= 6) {
                            putMsg({
                                alert: "最多只能上传6张图！"
                            });
                            return false;
                        }
                        var files = this.files = obj.pushFile();
                        obj.preview(function (index, file, result) {
                            var tr = $(['<tr id="upload-' + index + '">'
                                , '<td>' + file.name + '</td>'
                                , '<td>' + (file.size / 1014).toFixed(1) + 'kb</td>'
                                , '<td>等待上传</td>'
                                , '<td>'
                                , '<button class="layui-btn layui-btn-xs demo-see" data-img="' + result + '">查看</button>'
                                , '<button class="layui-btn layui-btn-xs layui-btn-danger demo-delete">删除</button>'
                                , '</td>'
                                , '</tr>'].join(''));

                            //查看
                            tr.find('.demo-see').on('click', function () {
                                layOpen({
                                    type: 1,
                                    content: "<img src='" + $(this).attr("data-img") + "' style='width:100%;' />",
                                    area: ["80%", "80%"]
                                });
                                return false;
                            });

                            //删除
                            tr.find('.demo-delete').on('click', function () {
                                layer.confirm("确认删除这张图吗？", function (index) {
                                    delete files[index]; //删除对应的文件
                                    tr.remove();
                                    var inp = $("#sbzp1").next().val("");
                                    formData1.count1--;
                                    layer.close(index);
                                });
                                return false;
                            });

                            $("#demoList1").append(tr);
                            formData1.count1++;
                        });
                    }, done: function (res, index, upload) {
                        if (res.code === 0) {
                            formData1.eqSbzp.push(res.data);
                            var tr = $("#demoList1").find('tr#upload-' + index)
                                , tds = tr.children();
                            tds.eq(2).html('<span style="color: #5FB878;">上传成功</span>');
                            tds.eq(3).html(''); //清空操作
                            $("#tjjjDrurl").val($("#tjjjDrurl").val() + res.data);
                            console.log($("#tjjjDrurl").val())
                            return delete this.files[index]; //删除文件队列已经上传成功的文件
                        }
                        this.error(index, upload);
                    }, error: function (index, upload) {
                        var tr = $("#demoList1").find('tr#upload-' + index)
                            , tds = tr.children();
                        tds.eq(2).html('<span style="color: #FF5722;">上传失败</span>');
                        console.log("index:" + index);
                        console.log("upload" + upload);
                    }
                }
            ]
        },
        bind: {
            addItem: [
                {
                    elem: "#dataTable1",
                    base: "./child/handover-add2.html",
                    name: "vg",
                    key: "key",
                    before: function () {
                        // console.log("scsName");
                        // $("#htYf").val($("#sbcsIdScs").val());
                    }
                }

            ],
            delItem: ".delNew"
            /*selectItem: [
                {
                    elem: "#selectEmp",
                    cb: "/eq/listEqbt",
                    db: "/eq/listEqByX?bmName="+ emp.bmName,
                    name: "dtdt",
                    key: "radio",
                    data: formData2,
                    end:function(){
                        attr();
                        alert("123")
                        console.log(formData2);
                    }
                }

            ]*/
        }

    };
</script>


</body>
</html>