<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>
    <title>编写</title>
    <link rel="stylesheet" type="text/css" href="/static/admin/layui/css/layui.css"/>
    <link rel="stylesheet" type="text/css" href="/static/admin/css/admin.css"/>
    <script src="/static/admin/js/jquery-3.3.1.min.js"></script>
    <!--[if IE 8]>
    <script type="text/javascript" src="/static/admin/js/jquery-1.11.3.min.js"></script>
    <![endif]-->
    <script src="/static/admin/js/basic.js"></script>
    <style>
        .layui-form-label {
            width: 130px !important;
        }

        .layui-input-block {
            margin-left: 130px !important;
        }

        .layui-form-text .layui-form-label {
            width: 100% !important;
        }

        .layui-form-text .layui-input-block {
            margin-left: 0 !important;
        }

        input[type="file"] {
            margin: 7px;
        }
    </style>
</head>

<body>


<form class="layui-form layui-form-pane" action="" lay-filter="forms">
    <div class="layui-row">
        <fieldset class="layui-elem-field layui-field-title">
            <legend>设备信息</legend>
        </fieldset>
        <div class="col-xs-12 col-sm-6">
            <div class="layui-form-item">
                <label class="layui-form-label">设备编号<span class="sign">*</span></label>
                <div class="layui-input-block">
                    <input readonly type="text" name="eqSbbh"  class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">设备名称<span class="sign">*</span></label>
                <div class="layui-input-block">
                    <input type="text" readonly name="eqName"  class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">设备品名<span class="sign">*</span></label>
                <div class="layui-input-block">
                    <input type="text" name="eqPmName" readonly  class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">设备品牌</label>
                <div class="layui-input-block">
                    <input type="text" name="eqPp" readonly class="layui-input">
                </div>
            </div>
        </div>
        <div class="col-xs-12 col-sm-6">
            <div class="layui-form-item">
                <label class="layui-form-label">设备规格</label>
                <div class="layui-input-block">
                    <input type="text" name="eqGg" readonly class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">设备型号</label>
                <div class="layui-input-block">
                    <input type="text" name="eqXh" readonly class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">部门名称</label>
                <div class="layui-input-block">
                    <input type="text" name="bmName" id="bmName" readonly class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">图片</label>
                <div class="layui-input-block">
                        <img id="gcc" src="" style="color:red"  alt="未上传图片或图片异常">
                </div>
            </div>

        </div>
    </div>

    <div class="layui-row">
        <fieldset class="layui-elem-field layui-field-title">
            <legend>操作规程信息</legend>
        </fieldset>
        <div class="col-xs-12 col-sm-6">
            <div class="layui-form-item">
                <label class="layui-form-label">操作规程名称 <span class="sign">*</span></label>
                <div class="layui-input-block">
                    <input type="text" name="czGcMc" readonly class="layui-input">
                </div>
            </div>
            <div class="layui-form-item layui-form-text">
                <label class="layui-form-label">操作规程内容</label>
                <div class="layui-input-block">
                    <textarea type="text" name="czGcNr" readonly id="czGcNr" class="layui-textarea"></textarea>
                </div>
            </div>
        </div>
        <div class="col-xs-12 col-sm-6">
            <div class="layui-form-item">
                <label class="layui-form-label">拟稿人<span class="sign">*</span></label>
                <div class="layui-input-block">
                    <input type="text" name="czGcNgr" id="czGcNgr" readonly class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">类别<span class="sign">*</span></label>
                <div class="layui-input-block">
                    <input type="text" name="czGcLb" readonly value="操作流程" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">总页数<span class="sign">*</span></label>
                <div class="layui-input-block">
                    <input type="text" name="czGcZys" readonly class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">拟稿日期<span class="sign">*</span></label>
                <div class="layui-input-block">
                    <input type="text" name="czGcNgrq" id="czGcNgrq" readonly class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">版本号<span class="sign">*</span></label>
                <div class="layui-input-block">
                    <input type="text" name="czGcBbh" readonly value="V1.0" class="layui-input">
                </div>
            </div>
        </div>
    </div>
    <div class="layui-row">
        <fieldset class="layui-elem-field layui-field-title">
            <legend>审核信息</legend>
        </fieldset>
        <div class="col-xs-12 col-sm-6">
            <div class="layui-form-item">
                <label class="layui-form-label">审核人<span class="sign">*</span></label>
                <div class="layui-input-block">
                    <input readonly type="text" name="czGcShr" id="czGcShr" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">审核日期<span class="sign">*</span></label>
                <div class="layui-input-block">
                    <input readonly type="text" name="czGcShrq" id="czGcShrq" autocomplete="off" class="layui-input">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">试用天数(天)<span class="sign">*</span></label>
                <div class="layui-input-block">
                    <input readonly type="text" name="czGcSyts" id="czGcSyts" autocomplete="off" class="layui-input">
                </div>
            </div>
        </div>
        <div class="col-xs-12 col-sm-6">
            <div class="layui-form-item layui-form-text">
                <label class="layui-form-label">审核意见<span class="sign">*</span></label>
                <div class="layui-input-block">
                    <textarea type="text" name="czGcShyj" id="czGcShyj" autocomplete="off" class="layui-textarea"></textarea>
                </div>
            </div>
        </div>

        <input type="text" name="gcUrl" id="gcUrl" class="hidden">
        <div class="col-xs-12">
            <div class="layui-form-item subBtn">
                <div class="layui-input-block">
                    <button class="layui-btn" lay-submit="" lay-filter="demo1">保存</button>
<!--                    <button type="reset" class="layui-btn layui-btn-primary">重置</button>-->
                </div>
            </div>
        </div>
    </div>
    <input type="text" class="hidden" id="czGcZt" name="czGcZt">
    <input type="hidden" name="bmId" id="bmId" class="layui-input">
    <input type="text" class="hidden" name="id" id="id">


</form>


<div id="tips">

</div>


<script>

    $("#id").val($.getUrlParam("id"));
    // function btnClick(){
    //     $("#btn_forbidden").click(function(){
    //
    //     })
    // }
    //
    // $(document).ready(function(){
    //     btnClick();
    // });

    // 表单
    layui.use(['form','layedit'], function(){

        var form = layui.form
            ,layer = layui.layer
            ,layedit = layui.layedit;

        index = layedit.build('czGcNr',{
            tool:[]
        }); //建立编辑器



        form.on('submit(demo1)', function(data){
            // layer.alert(JSON.stringify(data.field), {
            //     title: '最终的提交信息'
            // });

            $.ajax({
                type: "POST",
                dataType: 'json',
                url: '/lifeManage/CzgcAfterSh',
                data: JSON.stringify(data.field),
                contentType: 'application/json; charset=UTF-8',
                success: function(result) {
                    layui.layer.alert('提交成功!');
                    var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
                    parent.layer.close(index); //再执行关闭
                    window.top.location.reload();
                },
                error:function(){
                    layer.alert(JSON.stringify(data.field), {
                        title: '最终的提交信息'
                    });
                    layer.alert("error");
                }
            });
            return false;
        });
    });

    var emp = tempValue("rl", "emp", false);

    //console.log(bmUrl);
    renderMod.form = {
        val:{
            filter:"forms",//与form标签lay-filter相同
            get:{
                url:"/lifeManage/selectOneCzgc",
                type:"POST",
                data:{id:$.getUrlParam("id")}
            },
            func:function(data) {
                // 获取时间
                function CurentTime()
                {
                    var now = new Date();

                    var year = now.getFullYear();       //年
                    var month = now.getMonth() + 1;     //月
                    var day = now.getDate();            //日

                    var clock = year + "-";

                    if(month < 10)
                        clock += "0";

                    clock += month + "-";

                    if(day < 10)
                        clock += "0";

                    clock += day;

                    return(clock);
                }
                $("#czGcShr").val(emp.userXm);
                $("#czGcShrq").val(CurentTime());
                $("#czGcSyts").val("30");
                $("#czGcZt").val("1");
                var url= $("#gcUrl").val();
                $("#gcc").attr("src",url.substring(0, url.lastIndexOf(',')))
                $("#czGcNr").next().find('iframe').contents().find('body').prop("contenteditable",false);
                layui.layedit.setContent(index, data.czGcNr);

            }
        },
        date:{
            elem:"#yjyaZpjsqsj",
            format:'yyyy-MM-dd',
            isInitValue:true,
            value:today
        }
    };




</script>
</body>

</html>