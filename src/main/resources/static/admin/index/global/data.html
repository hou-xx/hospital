<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>
    <title>数据</title>
    <link rel="stylesheet" type="text/css" href="../../../static/admin/layui/css/layui.css"/>
    <link rel="stylesheet" type="text/css" href="../../../static/admin/css/admin.css"/>
    <link rel="stylesheet" href="../../../static/admin/css/all.min.css"/>
    <script src="../../../static/admin/js/jquery-3.3.1.min.js"></script>
    <!--[if IE 8]>
    <script type="text/javascript" src="../../../static/admin/js/jquery-1.11.3.min.js"></script>
    <![endif]-->
    <script src="../../../static/admin/js/basic.js"></script>
</head>

<body>
<div class="layui-row">
    <div class="col-xs-12 padRight">
        <table id="table" lay-filter="table1"></table>
    </div>
</div>

<script type="text/html" id="toolBar">
    <form class="layui-form layui-form-pane maxCont" id="search" action="">
        <div class="layui-inline xs-100 mar10-0 pad0-10" style="margin-right:10px;">
            <a class="layui-btn layui-btn-warm" lay-event="setThisData">选定数据</a>
        </div>
        <div class="DiyDom" id="diyDOM">
            <div class="layui-inline mar10-0">
                <input class="layui-input" name="search" placeholder="搜索....">
            </div>
        </div>

        <div class="layui-input-inline mar10-0" align="center">
            <button class="layui-btn" data-type="reload">搜索</button>
        </div>
    </form>
</script>
<script id="timeFormat" type="text/html">
    //日期转换
    {{#
    var time ="";
    layui.use('util',function(){
    var util = layui.util;
    time = layui.util.toDateString(new Date(d.kmSj).getTime(),"yyyy-MM-dd");
    });
    return time;
    }}
</script>

<script>
    var $url_cols= $.getUrlParam("cb") || "/benefical/select/listSelectCols",//表头链接
        $url_data= $.getUrlParam("db") || "/benefical/select/listSelect",//表格数据获取链接
        $url_search= $.getUrlParam("se") || "",//表格搜索相关数据获取链接
        $key = $.getUrlParam("key"),//页面判断参数
        colsData = [],//表头判断
        searchDom=$("#diyDOM"),//搜索数据DOM
        searchParam=false;//搜索参数,false不使用
    subUp({
        url: $url_cols,
        type: "POST",
        data: {key: $key},
        success: function (res) {
            if(res.code !== 0){
                putMsg({
                        alert:"数据获取失败，请重试！"
                    });
                return false;
            }
            //console.log("===SUBUP===");
            //console.log(res);
            //判断是否为二重数组，是则直接使用，否则嵌套一层数据
            if(Type(res.data.list[0]) === "array"){
                colsData =res.data.list;
            }else{
                colsData.push(res.data.list);
            }
            console.log(colsData);
            //未填写se参数则代表使用默认条件
            if($url_search !== ""){
                subUp({
                    url:$url_search,
                    type:"POST",
                    data:{key:$key},
                    async:false,//同步
                    success:function(res){
                        searchDom.html(res.data.list.dom);
                        searchParam = res.data.list.data;
                    }
                })
            }

            renderMod = {
                table: {
                    table: {
                        cols: colsData
                        , defaultToolbar: []
                        , url: $url_data
                        , method: "POST"
                        , request: {
                            pageName: 'pageNum',
                            limitName: 'pageSize'
                        }
                        , where: {
                            key: $key
                        }
                        , parseData: function (res) { //res 即为原始返回的数据
                            return {
                                "code": res.code, //解析接口状态
                                "msg": res.msg, //解析提示文本
                                "count": res.data.total,//页数据数
                                "data": res.data.list //解析数据列表
                            }
                        }
                        , done: function (obj) {
                            tableFunc({
                                "obj": obj,
                                "toolFunc": [
                                    {
                                        tool: "toolbar",
                                        event: "setThisData",
                                        layOpen: false,
                                        func: function (obj, cs) {
                                            var name = $.getUrlParam("vg") || "dtdt",key = $.getUrlParam("v") || $.getUrlParam("key") || "tempData";
                                            layui.sessionData(name, {
                                                key: key,
                                                value: cs.data
                                            });
                                            var index = parent.layer.getFrameIndex(window.name); //先得到当前iframe层的索引
                                            parent.layer.close(index); //再执行关闭
                                        }
                                    }
                                ]
                            })
                        }
                    },
                    reSet:searchParam
                }
            };
        }
    })

</script>
</body>

</html>