<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>
    <title>设备信息查询-编辑</title>
    <link rel="stylesheet" type="text/css" href="/static/admin/layui/css/layui.css"/>
    <link rel="stylesheet" type="text/css" href="/static/admin/css/admin.css"/>
    <script src="/static/admin/js/jquery-3.3.1.min.js"></script>
    <!--[if IE 8]>
    <script type="text/javascript" src="/static/admin/js/jquery-1.11.3.min.js"></script>
    <![endif]-->
    <script src="/static/admin/js/basic.js"></script>
    <style type="text/css">
        .layui-form-label {
            width: 140px;
            padding: 8px 8px !important;
        }

        .layui-form-item {
            margin-top: 25px;
        }

        .warm_btn {
            height: 45px;
            font-size: 1.3em;
            letter-spacing: 3px;
            margin: 10px 0 30px;
        }
    </style>
</head>
<body>
<div class="layui-row">
    <div class="col-xs-12">
        <div class="layui-collapse" style="margin-top:20px;">
            <form class="layui-form layui-form-pane" action="" lay-filter="eqForm">
                <div class="layui-colla-item">
                    <h2 class="layui-colla-title">基本信息</h2>
                    <div class="layui-colla-content layui-show">
                        <div class="layui-row">
                            <div class="col-xs-12 col-sm-6">
                                <div class="layui-form-item">
                                    <label class="layui-form-label">设备名称</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="eqName" autocomplete="off" class="layui-input">
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">产品编号<span class="sign">*</span></label>
                                    <div class="layui-input-block">
                                        <input type="text" name="eqZcbh" autocomplete="off" class="layui-input">
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label" style="height:46px;line-height:30px;">品名<span
                                            class="sign">*</span></label>
                                    <div class="layui-input-block">
                                        <input type="text" name="eqPmName" placeholder="请选择" lay-verify="require"
                                               autocomplete="off" disabled class="layui-input"
                                               style="height:46px;padding-left:60px;">
                                        <button class="layui-btn layui-btn-normal layui-btn-sm PoAb0xx0" lay-filter="pm"
                                                id="pm">选择
                                        </button>
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">台账类别</label>
                                    <div class="layui-input-block">
                                        <select name="eqTzlb" lay-filter="tzlb">
                                            <option value="低值耐用品类">低值耐用品类</option>
                                            <option value="固定资产类">固定资产类</option>
                                            <option value="基建类">基建类</option>
                                            <option value="第三方类">第三方类</option>
                                            <option value="试用类">试用类</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">保修期开始时间</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="eqBxkssj" id="date" placeholder="2018-12-04"
                                               autocomplete="off" class="layui-input">
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">设备型号</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="eqXh" autocomplete="off" class="layui-input">
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">设备规格</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="eqGg" autocomplete="off" class="layui-input">
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">经费来源</label>
                                    <div class="layui-input-block">
                                        <select name="zjlyId" lay-filter="zjly">
                                            <option></option>
                                        </select>
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">单位</label>
                                    <div class="layui-input-block">
                                        <select name="eqJldwId" lay-filter="dwList">
                                        </select>
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">单价<span class="sign">*</span></label>
                                    <div class="layui-input-block">
                                        <input type="text" name="eqPrice" autocomplete="off" class="layui-input"
                                               placeholder="3000">
                                    </div>
                                </div>
                            </div>

                            <div class="col-xs-12 col-sm-6">
                                <div class="layui-form-item">
                                    <label class="layui-form-label">使用部门</label>
                                    <div class="layui-input-block">
                                        <select name="eqBmid" lay-filter="bmList">
                                        </select>
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">管理归口<span class="sign">*</span></label>
                                    <div class="layui-input-block">
                                        <select name="eqGlgk" lay-filter="">
                                            <option value="信息">信息</option>
                                            <option value="医工">医工</option>
                                            <option value="后勤">后勤</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">设备分类</label>
                                    <div class="layui-input-block">
                                        <select name="eqCxflId" lay-filter="cxfl">
                                        </select>
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">启用日期</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="eqQysj" id="date1" placeholder="2018-12-04"
                                               autocomplete="off" class="layui-input">
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">保修期结束时间</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="eqBxjssj" id="date2" placeholder="2018-12-04"
                                               autocomplete="off" class="layui-input">
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label" style="height:46px;line-height:30px;">维修商</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="wxsName" placeholder="请选择" autocomplete="off" disabled
                                               class="layui-input" style="height:46px;padding-left:60px;">
                                        <button class="layui-btn layui-btn-normal layui-btn-sm PoAb0xx0" id="wxs">选择
                                        </button>
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">注册证名称</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="eqZczmc" autocomplete="off" class="layui-input">
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">注册证编码</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="eqZczbh" autocomplete="off" class="layui-input">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="layui-colla-item">
                    <h2 class="layui-colla-title">其他信息</h2>
                    <div class="layui-colla-content layui-show">
                        <div class="layui-row">
                            <div class="col-xs-12 col-sm-6">
                                <div class="layui-form-item">
                                    <label class="layui-form-label" style="height:46px;line-height:30px;">生产商</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="scsName" placeholder="请选择" autocomplete="off" disabled
                                               class="layui-input" style="height:46px;padding-left:60px;">
                                        <button class="layui-btn layui-btn-normal layui-btn-sm PoAb0xx0"
                                                lay-filter="scs" id="scs">选择
                                        </button>
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">品牌</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="eqPp" autocomplete="off" class="layui-input">
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">生产日期</label>
                                    <div class="layui-input-block">
                                        <input type="text" class="layui-input" autocomplete="off" id="date3">
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">生产编号</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="eqScbh" class="layui-input" autocomplete="off">
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">配置</label>
                                    <div class="layui-input-block">
                                        <select name="eqPz">
                                            <option value="标配">标配</option>
                                            <option value="选配">选配</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">使用年限(月)</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="eqSynx" autocomplete="off" class="layui-input"
                                               placeholder="60">
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label" style="height:46px;line-height:30px;">供应商</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="gysName" placeholder="请选择" autocomplete="off" disabled
                                               class="layui-input" style="height:46px;padding-left:60px;">
                                        <button class="layui-btn layui-btn-normal layui-btn-sm PoAb0xx0"
                                                lay-filter="gys" id="gys">选择
                                        </button>
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">合同编号</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="eqHtbh" class="layui-input" autocomplete="off">
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">采购日期</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="eqCgrq" class="layui-input" autocomplete="off"
                                               id="date4">
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">使用部门负责人</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="eqSybmfzr" autocomplete="off" class="layui-input">
                                    </div>
                                </div>
                            </div>

                            <div class="col-xs-12 col-sm-6">
                                <div class="layui-form-item">
                                    <label class="layui-form-label">安装日期</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="eqAzrq" class="layui-input" autocomplete="off"
                                               id="date5">
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">安装位置</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="eqAzwz" class="layui-input" autocomplete="off">
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">值班类型</label>
                                    <div class="layui-input-block">
                                        <select name="eqZblx" lay-filter="">
                                            <option value="白班">白班</option>
                                            <option value="夜班">夜班</option>
                                            <option value="全天">全天</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">折旧率</label>
                                    <div class="layui-input-block">
                                        <input type="text" class="layui-input" name="eqZjl" autocomplete="off"
                                               placeholder="0">
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">建档人</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="userName" class="layui-input" autocomplete="off">
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">建档日期</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="eqJdrq" class="layui-input" autocomplete="off"
                                               id="date6">
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">卷宗编号</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="eqJzbh" class="layui-input" autocomplete="off">
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">档案编号</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="eqDabh" autocomplete="off" class="layui-input">
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">院区</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="eqYq" autocomplete="off" class="layui-input">
                                    </div>
                                </div>
                                <div class="layui-form-item">
                                    <label class="layui-form-label">备注</label>
                                    <div class="layui-input-block">
                                        <input type="text" name="eqBz" autocomplete="off" class="layui-input">
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="layui-row">
                            <div class="col-xs-12">
                                <fieldset class="layui-elem-field layui-field-title">
                                    <legend>设备照片</legend>
                                </fieldset>
                            </div>
                            <div class="layui-row">
                                <div class="col-xs-12 col-sm-6">
                                    <div class="layui-form-item" pane>
                                        <label class="layui-form-label">设备照片</label>
                                        <div class="layui-input-block">
                                            <button type="button" class="layui-btn layui-btn-sm layui-btn-normal" id="sbzp">选择文件</button>
                                            <button type="button" class="layui-btn layui-btn-sm layui-btn-normal" id="sbzp_sub">上传文件</button>
                                        </div>
                                    </div>
                                    <div class="layui-upload-list">
                                        <table class="layui-table">
                                            <thead>
                                            <tr><th>文件名</th>
                                                <th>大小</th>
                                                <th>状态</th>
                                                <th>操作</th>
                                            </tr></thead>
                                            <tbody id="demoList1"></tbody>
                                        </table>
                                    </div>
                                </div>
                                <div class="col-xs-12 col-sm-6">
                                    <div class="layui-form-item" pane>
                                        <label class="layui-form-label">铭牌照片</label>
                                        <div class="layui-input-block">
                                            <button type="button" class="layui-btn layui-btn-sm layui-btn-normal" id="mpzp">选择文件</button>
                                            <button type="button" class="layui-btn layui-btn-sm layui-btn-normal" id="mpzp_sub">上传文件</button>
                                        </div>
                                    </div>
                                    <div class="layui-upload-list">
                                        <table class="layui-table">
                                            <thead>
                                            <tr><th>文件名</th>
                                                <th>大小</th>
                                                <th>状态</th>
                                                <th>操作</th>
                                            </tr></thead>
                                            <tbody id="demoList"></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>

                            <div class="layui-row">
                                <div class="col-xs-12">
                                    <fieldset class="layui-elem-field layui-field-title">
                                        <legend>安装环境及要求</legend>
                                    </fieldset>
                                </div>
                                <div class="col-xs-12">
                                    <div class="layui-form-item layui-form-text">
                                        <label class="layui-form-label">安装环境及要求</label>
                                        <div class="layui-input-block">
                                            <textarea class="layui-textarea" name="eqAzhjyq"></textarea>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="layui-row">
                            <div class="col-xs-12">
                                <button class=" layui-btn layui-btn-fluid" lay-submit=""
                                        lay-filter="submit">提 交
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>


<script>
</script>
<script>
    formData = {};
    formData.count = 0;//铭牌图片上传数量
    formData.count1 = 0;//设备图片上传数量
    formData.eqMpzp = [];
    formData.eqSbzp = [];
    var isCan1 = false,
    isCan2 = false;
    renderMod = {
        form: {
            submit: {
                filter: "submit",//可以不写
                before: function () {
                    var ad = {};
                    if (formData.eqSbzp !== undefined) {
                        ad.eqSbzp = formData.eqSbzp;
                    }
                    if (formData.eqMpzp !== undefined) {
                        ad.eqMpzp = formData.eqMpzp;

                    }
                    if (formData.radio !== undefined) {
                        ad.eqPmId = formData.radio[0].eqPmId
                    }
                    if (formData.wxs !== undefined) {
                        ad.sbcsIdWxs = formData.wxs[0].sbcsIdWxs
                    }
                    if (formData.scs !== undefined) {
                        ad.sbcsIdScs = formData.scs[0].sbcsIdScs
                    }
                    if (formData.gys !== undefined) {
                        ad.sbcsIdGys = formData.gys[0].sbcsIdGys
                    }
                    return param = {
                        1: ad.eqSbzp,
                        2: ad.eqMpzp,
                        3: ad.eqPmId,
                        4: ad.sbcsIdWxs,
                        5: ad.sbcsIdScs,
                        6: ad.sbcsIdGys,
                        7: $.getUrlParam("eqId")
                    }
                },
                form: {
                    url: "/eq/updateEq",
                    type: "POST",
                    contentType: "application/json",
                    data: ["eqName", "eqZcbh", "eqPmId", "eqGg", "eqXh", "zjlyId",
                        "eqJldwId", "eqPrice", "eqTzlb", "eqBxkssj", "eqBxjssj", "eqBxxysj",
                        "eqBmid", "eqGlgk", "eqCxflId", "eqQysj", "eqZczmc", "eqZczbh", "eqPp", "eqScbh",
                        "eqPz", "eqSynx", "eqHtbh", "eqCgrq", "eqSybmfzr", "eqAzrq", "eqAzwz",
                        "eqZblx", "eqZjl", "userName", "eqJdrq", "eqJzbh", "eqDabh", "eqYq", "eqSbzp",
                        "eqMpzp", "eqAzhjyq"],
                    param: {
                        1: "sbzp",
                        2: "mpzp",
                        3: "eqPmId",
                        4: "sbcsIdWxs",
                        5: "sbcsIdScs",
                        6: "sbcsIdGys",
                        7: "eqId"
                    },
                    reload: true
                }
            },
            date: [
                {
                    elem: '#date',
                    value: today0
                },
                {
                    elem: '#date1',
                    value: today0
                },
                {
                    elem: '#date2',
                    value: today0
                },
                {
                    elem: '#date3',
                    value: today0
                },
                {
                    elem: '#date4',
                    value: today0
                },
                {
                    elem: '#date5',
                    value: today0
                },
                {
                    elem: '#date6',
                    value: today0
                }
            ],
            file: [
                {
                    elem: "#sbzp",
                    url: "/eq/uploadFile",
                    accept: "images",
                    acceptMime: "image/*",
                    multiple: true,
                    auto: false,
                    bindAction: "#sbzp_sub",
                    number:4,
                    field: "file",
                    choose: function (obj) {
                        if (formData.count1 > 4) {
                            putMsg({
                                alert: "上传数量已打最大值！"
                            });
                            return false;
                        }
                        var files  = this.files = obj.pushFile();
                        obj.preview(function (index, file, result) {
                            var tr = $(['<tr id="upload-' + index + '">'
                                , '<td>' + file.name + '</td>'
                                , '<td>' + (file.size / 1014).toFixed(1) + 'kb</td>'
                                , '<td>等待上传</td>'
                                , '<td>'
                                , '<button class="layui-btn layui-btn-xs demo-see" data-img="' + result + '">查看</button>'
                                , '<button class="layui-btn layui-btn-xs layui-btn-danger demo-delete">删除</button>'
                                , '</td>'
                                , '</tr>'].join(''));

                            //查看
                            tr.find('.demo-see').on('click',showsI);

                            //删除
                            tr.find('.demo-delete').on('click', function () {
                                layer.confirm("确认删除这张图吗？", function (el) {
                                    delete files[index]; //删除对应的文件
                                    tr.remove();
                                    var inp = $("#sbzp").next().val("");
                                    formData.count1--;
                                    layer.close(el);
                                });
                                return false;
                            });

                            $("#demoList1").append(tr);
                            formData.count1++;
                        });
                    },
                    done: function (res, index, upload) {
                        if(formData.count1 > 4) {
                            var tr1 = $("#demoList1").find('tr#upload-' + index)
                                , tds1 = tr1.children();
                            tds1.eq(2).html('<span style="color: #f19102;">等待重传</span>');
                            putMsg({
                                alert: "最多只能上传4张图片，请删除多余图片！"
                            });
                            return false;
                        }else{
                            if (res.code === 0) {
                                formData.eqSbzp.push(res.data);
                                var tr = $("#demoList1").find('tr#upload-' + index)
                                    , tds = tr.children();
                                tds.eq(2).html('<span style="color: #5FB878;">上传成功</span>');
                                tds.eq(3).html(
                                    $("<button>").attr({
                                        class:"layui-btn layui-btn-xs demo-see",
                                        dataImg: res.data
                                    }).text("查看").on("click",showsI)
                                );
                                return delete this.files[index]; //删除文件队列已经上传成功的文件
                            }
                            this.error(index, upload);
                        }

                    },
                    error: function (index, upload) {
                        var tr = $("#demoList1").find('tr#upload-' + index)
                            , tds = tr.children();
                        tds.eq(2).html('<span style="color: #FF5722;">上传失败</span>');
                        console.log("index:" + index);
                        console.log("upload" + upload);
                    }
                },
                {
                    elem: "#mpzp",
                    url: "/eq/uploadFile",
                    accept: "images",
                    acceptMime: "image/!*",
                    auto: false,
                    multiple: true,
                    bindAction: "#mpzp_sub",
                    field: "file",
                    number:4,
                    choose: function (obj) {
                        if (formData.count > 4) {
                            putMsg({
                                alert: "上传数量已打最大值！"
                            });
                            return false;
                        }
                        var files = this.files = obj.pushFile();
                        obj.preview(function (index, file, result) {
                            var tr = $(['<tr id="upload-' + index + '">'
                                , '<td>' + file.name + '</td>'
                                , '<td>' + (file.size / 1014).toFixed(1) + 'kb</td>'
                                , '<td>等待上传</td>'
                                , '<td>'
                                , '<button class="layui-btn layui-btn-xs demo-see" data-img="' + result + '">查看</button>'
                                , '<button class="layui-btn layui-btn-xs layui-btn-danger demo-delete">删除</button>'
                                , '</td>'
                                , '</tr>'].join(''));

                            //查看
                            tr.find('.demo-see').on('click',showsI);

                            //删除
                            tr.find('.demo-delete').on('click', function () {
                                layer.confirm("确认删除这张图吗？", function (el) {
                                    delete files[index]; //删除对应的文件
                                    tr.remove();
                                    var inp = $("#mpzp").next().val("");
                                    formData.count--;
                                    layer.close(el);
                                });
                                return false;
                            });

                            $("#demoList").append(tr);
                            formData.count++;
                        });
                    }
                    ,done: function (res, index, upload) {
                        if(formData.count > 4){
                            var tr1 = $("#demoList").find('tr#upload-' + index)
                                , tds1 = tr1.children();
                            tds1.eq(2).html('<span style="color: #f19102;">等待重传</span>');
                            putMsg({
                                alert: "最多只能上传4张图片，请删除多余图片！"
                            });
                            return false;
                        }else{
                            if (res.code === 0) {
                                formData.eqMpzp.push(res.data);
                                var tr = $("#demoList").find('tr#upload-' + index)
                                    , tds = tr.children();
                                tds.eq(2).html('<span style="color: #5FB878;">上传成功</span>');
                                tds.eq(3).html(
                                    $("<button>").attr({
                                        class:"layui-btn layui-btn-xs demo-see",
                                        dataImg: res.data
                                    }).text("查看").on("click",showsI)
                                );
                                return delete this.files[index]; //删除文件队列已经上传成功的文件
                            }
                            this.error(index, upload);
                        }
                    }, error: function (index, upload) {
                        var tr = $("#demoList1").find('tr#upload-' + index)
                            , tds = tr.children();
                        tds.eq(2).html('<span style="color: #FF5722;">上传失败</span>');
                        console.log("index:" + index);
                        console.log("upload" + upload);
                    }
                }
            ],
            val: {
                get: {
                    url: "/eq/getEqById",
                    data: {
                        eqId: $.getUrlParam("eqId")
                    }
                },
                filter: "eqForm",
                select: [
                    {
                        filter: "dwList",
                        ids: "eqJldwId",
                        text: "eqJldwName",
                        url: "/eqdict/jldw"
                    },
                    {
                        filter: "zjly",
                        ids: "zjlyId",
                        text: "zjlyName",
                        url: "/eqdict/zjly"
                    },
                    {
                        filter: "cxfl",
                        ids: "eqCxflId",
                        text: "eqCxflName",
                        url: "/eqdict/cxfl"
                    },
                    {
                        filter: "bmList",
                        ids: "bmId",
                        text: "bmName",
                        url: "/supervise/bmgl/listBms2"
                    }
                ],
                func: function (data, form) {
                    console.log($.getUrlParam("eqId"));
                    $("select[name='zjlyId']").val(String(data["zjlyId"]).trim());
                    $("select[name='eqBmid']").val(String(data["eqBmid"]).trim());
                    $("select[name='eqJldwId']").val(String(data["eqJldwId"]).trim());
                    $("select[name='eqCxflId']").val(String(data["eqCxflId"]).trim());
                    $("select[name='eqZblx']").val(String(data["eqZblx"]).trim());
                    $("select[name='eqPmId']").val(String(data["eqPmId"]).trim());

                    form.render("select");
                    if (data.eqSbzp) {
                        var newSb = data.eqSbzp.split(",");
                        var $sImg = $("#sbImg");
                        $sImg.html($("<ul>"));
                        var tr;
                        for (var i = 0; i < newSb.length; i++) {
                            formData.count1 ++ ;
                            formData.eqSbzp.push(newSb[i]);
                            tr = $(['<tr id="upload-n' + i + '">'
                                , '<td>图片'+(i+1)+ '</td>'
                                , '<td>-</td>'
                                , '<td>原上传</td>'
                                , '<td>'
                                , '<button class="layui-btn layui-btn-xs demo-see" data-img="' + newSb[i] + '">查看</button>'
                                , '<button class="layui-btn layui-btn-xs layui-btn-danger demo-delete">删除</button>'
                                , '</td>'
                                , '</tr>'].join(''));

                            //查看
                            tr.find('.demo-see').on('click', function () {
                                layOpen({
                                    type: 1,
                                    content: "<img src='" + $(this).attr("data-img") + "' style='width:100%;' />",
                                    area: ["80%", "80%"]
                                });
                                return false;
                            });

                            //删除
                            tr.find('.demo-delete').on('click',{index:i}, function (event) {
                                var index = event.data.index;
                                layer.confirm("确认删除这张图吗？", function (num) {
                                    for(var k=0;k<formData.eqSbzp.length;k++){
                                        if(formData.eqSbzp[k] === newSb[index]){
                                            formData.eqSbzp.splice(k,1);
                                        }
                                    }
                                    $("tr#upload-n" + index).remove();
                                    formData.count1--;
                                    layer.close(num);
                                });
                                return false;
                            });

                            $("#demoList1").append(tr);
                        }
                    }
                    if (data.eqMpzp) {
                        var newMp = data.eqMpzp.split(",");
                        var $mImg = $("#mpImg");
                        $mImg.html($("<ul>"));
                        for (var j = 0; j < newMp.length; j++) {
                            formData.count ++ ;
                            formData.eqMpzp.push(newMp[j]);
                            tr = $(['<tr id="upload-n' + i + '">'
                                , '<td>图片'+(j+1)+ '</td>'
                                , '<td>-</td>'
                                , '<td>原上传</td>'
                                , '<td>'
                                , '<button class="layui-btn layui-btn-xs demo-see" data-img="' + newMp[i] + '">查看</button>'
                                , '<button class="layui-btn layui-btn-xs layui-btn-danger demo-delete">删除</button>'
                                , '</td>'
                                , '</tr>'].join(''));

                            //查看
                            tr.find('.demo-see').on('click', function () {
                                layOpen({
                                    type: 1,
                                    content: "<img src='" + $(this).attr("data-img") + "' style='width:100%;' />",
                                    area: ["80%", "80%"]
                                });
                                return false;
                            });

                            //删除
                            tr.find('.demo-delete').on('click',{index:j}, function (event) {
                                var index = event.data.index;
                                layer.confirm("确认删除这张图吗？", function (num) {
                                    for(var k=0;k<formData.eqMpzp.length;k++){
                                        if(formData.eqMpzp[k] === newMp[index]){
                                            formData.eqMpzp.splice(k,1);
                                        }
                                    }
                                    //delete files[index]; //删除对应的文件
                                    $("tr#upload-n" + index).remove();
                                    formData.count1--;
                                    layer.close(num);
                                });
                                return false;
                            });

                            $("#demoList").append(tr);
                        }
                    }
                }
            }
        },
        bind: {
            selectItem: [
                {
                    elem: "#pm",
                    data: formData,
                    cb: "/eq/listPmsCols",
                    db: "/eq/listPms",
                    se: "/eq/pmSe",
                    key: "radio",
                    name: "dtdt"
                },
                {
                    elem: "#scs",
                    data: formData,
                    cb: "/cs/scsTitle",
                    db: "/cs/listScs",
                    se: "/cs/listScsSe",
                    key: "scs",
                    name: "dtdt"
                },
                {
                    elem: "#gys",
                    data: formData,
                    cb: "/cs/gysTitle",
                    db: "/cs/listGys",
                    se: "/cs/listGysSe",
                    key: "gys",
                    name: "dtdt"
                },
                {
                    elem: "#wxs",
                    data: formData,
                    cb: "/cs/wxsTitle",
                    db: "/cs/listWxs",
                    se: "/cs/listWxsSe",
                    key: "wxs",
                    name: "dtdt"
                }


            ]
        }
    };

    /*$(".demo-see").on("click",function(){
        layOpen({
            type: 1,
            content: "<img src='" + $(this).attr("data-img") + "' style='width:100%;' />",
            area: ["80%", "80%"]
        });
        return false;
    })*/
    function showsI() {
        layOpen({
            type: 1,
            content: "<img src='" + $(this).attr("data-img") + "' style='width:100%;' />",
            area: ["80%", "80%"]
        });
        return false;
    }
</script>
</body>
</html>
