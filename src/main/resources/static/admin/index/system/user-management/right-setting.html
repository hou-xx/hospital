<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>
    <title>设备卫标分类设置</title>
    <link rel="stylesheet" type="text/css" href="/static/admin/layui/css/layui.css"/>
    <link rel="stylesheet" type="text/css" href="/static/admin/css/admin.css"/>
    <script src="/static/admin/js/jquery-3.3.1.min.js"></script>
    <!--[if IE 8]>
    <script type="text/javascript" src="/static/admin/js/jquery-1.11.3.min.js"></script>
    <![endif]-->
    <script src="/static/admin/js/basic.js"></script>
    <!--ZTREE-->
    <link rel="stylesheet" href="/static/admin/css/tree/ztree-liulinwj.css" type="text/css">
    <script src="/static/admin/js/jquery.ztree.all.js"></script>
    <script src="/static/admin/js/ztree-liulinwj_5.js"></script>
    <style>
        .layui-inline {
            width: 140px;
        }

        .tree-container {
            height: 610px;
            margin-left: 20px;
            margin-top: 10px;
            display: inline-block;
            padding: 10px;
            border: 1px solid #ddd;
            overflow: auto;
            float: left;
        }

        .layui-form-item {
            height: 46px;
        }


    </style>
</head>
<div class="tree-container col-xs-12 col-md-5">
    <div class="ztree ztree-liulinwj ztree-liulinwj-folder">
        <ul id="demo"></ul>
    </div>
</div>
<div class="tree-container col-xs-12 col-md-5">
    <form class="layui-form layui-form-pane" action="" lay-filter="forms">
        <div class="layui-form-item">
            <label class="layui-form-label">用户组</label>
            <div class="layui-input-block">
                <select name="nextShrId" lay-filter="shr">

                </select>
            </div>
        </div>
    </form>
</div>
<body>

<script>
    var setting = {
            view: {
                showLine: false,
                showIcon: false
            },
            data: {
                key: {
                    name: "name"
                }
            },
            callback: {
                "onClick": ckLine
            },
            check: {
                enable: true,
                chkStyle: "checkbox"
            }
        },
        newNode = {},
        nodes = {};

    function clickShow(event, treeId, treeNode) {
        console.log(arguments);
        layui.use("form", function () {
            var form = layui.form;
            form.val("shows", treeNode);
        })
    }

    function ckLine(event, treeId, treeNode, clickFlag) {
        // 判断是否父节点 !treeNode.isParent
        //if (true) {
            //alert("treeId自动编号：" + treeNode.tId + ", 节点id是：" + treeNode.id + ", 节点文本是：" + treeNode.name);
            $.ajax({
                url: "/tree/right1",//请求的action路径
                data: {"pid": treeNode.id},
                error: function () {//请求失败处理函数
                    layer.alert('请求失败');
                },
                success: function (res) { //添加子节点到指定的父节点
                    if (res.code === 0) {
                        if (res.data && res.data.length > 0) {
                            var treeObj = $.fn.zTree.getZTreeObj("demo");
                            //treeNode.halfCheck = false;
                            var parentZNode = treeObj.getNodeByParam("id", treeNode.id, null);//获取指定父节点
                            console.log(parentZNode);
                            treeObj.removeChildNodes(parentZNode);
                            newNode = treeObj.addNodes(parentZNode, res.data, false);
                            console.log(newNode);
                        }
                    }
                }
            });
        //}
    }

    $.ajax({
        url: "/tree/right1",
        type: "GET",
        data: {pid: ""},
        success: function (res) {
            if (res.code === 0) {
                //console.log(data);
                nodes = res.data;
                $.fn.zTree.beautify().init($("#demo"), setting, nodes);
            }

        }
    });

    renderMod = {
        form:{
            val:{

            }
        }
    }
</script>
</body>
</html>