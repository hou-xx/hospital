<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
	<title>数据收集</title>
	<link rel="stylesheet" href="../layui/css/layui.css">
	<link rel="stylesheet" href="../iconfont/iconfont.css">
	<link rel="stylesheet" href="../css/dataIndex.css">
	<script src="../js/jquery-3.3.1.min.js"></script>
	<script src="../iconfont/iconfont.js"></script>
	<script src="../../../../static/admin/js/basic.js"></script>
	<script src="../../../../static/admin/js/renderMod.js"></script>
</head>
<body>

<!-- 表格 -->
<table class="layui-hide" id="table" lay-filter="table1"></table>

<!--批量删除和添加-->
<script type="text/html" id="zq_toolbar">
	<div class="layui-btn-container">
		<a class="layui-btn layui-btn-sm" href="add1.html" style="background-color: #003366;"><i class="layui-icon "></i>新增</a>
	</div>
</script>

<script type="text/html" id="toolBar">
	<!-- 搜索区域 -->
	<button class="layui-btn layui-btn-xs" lay-event="delAll"
			style="background-color: #cc0033;height: 22px;margin-bottom: 5px;font-size: 12px;">
		<i class="layui-icon" style="margin-top: -15px;"></i>批量删除
	</button>
	<form action="" layui-filter="forms" style="margin-top: 0;">
		<!--联网仪编号-->
		<div class="layui-input-inline" style="width: 130px;">
			<input type="text" name="macid" autocomplete="off"
				   placeholder="联网仪编号" class="layui-input">
		</div>
		<!--部门-->
		<div class="layui-input-inline" style="width: 140px;">
			<select name="bmId"  lay-filter="bmId">
				<option value="">全部部门</option>
			</select>
		</div>
		<!--设备编号-->
		<div class="layui-input-inline" style="width: 130px;">
			<input type="text" name="eqSbbh" autocomplete="off" placeholder="设备编号" class="layui-input">
		</div>
		<div class="layui-input-inline">
			<button class="layui-btn" data-type="reload">查找</button>
			<button type="reset" class="layui-btn layui-btn-primary" style="margin-left: 0;">重置</button>
		</div>
	</form>
</script>

<!--编辑删除-->
<script type="text/html" id="barDemo">
	<a class="layui-btn layui-btn-xs edit" href=""
	   style="background-color: #ffb800;" lay-event="link">编辑</a>
	<a class="layui-btn layui-btn-xs" lay-event="delete" style="background-color: #cc0033;">删除</a>
</script>

<script src="../layui/layui.js"></script>
<script src="../js/dataIndex.js"></script>
<script>

	renderMod = {
		addTable: {
			table: {
				cols: [[ //表头
					{type: 'checkbox', fixed: 'left'}
					,{field:'eqSbbh', title:'设备编号'}
					,{field:'eqName', title:'设备名称'}
					,{field:'eqGg', title:'规格'}
					,{field:'eqXh', title:'型号'}
					,{field:'macID', title:'联网仪编号'}
					,{field:'endPointIP', title:'联网仪IP'}
					,{fixed: 'right', title:'操作', align:'center', toolbar: '#barDemo'}
				]]
				, url: "/deviceparameter/show"
				, method: "POST"
				, request: {
					pageName: 'pageNum',
					limitName: 'pageSize'
				}
				, where: {}
				, parseData: function (res) { //res 即为原始返回的数据
					return {
						"code": res.code, //解析接口状态
						"msg": res.msg, //解析提示文本
						"data": res.data.list, //解析数据列表
						"count": res.data.total //总数据数
					}
				}
				,done: function(obj){
					tableFunc({
						"tools":[
							{
								tool:"toolbar",
								event:"delAll",
								send:{
									id:"table",
									filter:"table1",
									name:"macIds",
									event:"delAll",
									url:"/deviceparameter/deletes",
									type:"POST",
									contentType:"application/json",
									par:"macID",
									reload:true
								},
							},
							{//一个基础的删除当前行数据按钮
								event: "delete",
								layOpen:false,
								func:function(obj){
									layer.confirm('确定删除设备联网设置吗？', function(index){
										subUp({
											url:"/deviceparameter/delete",
											data:{"macid":obj.data.macID,"eqSbbh":obj.data.eqSbbh},
											method:"POST",
											success:function(res){
												if(res.code === 0){
													// putMsg({
													// 	msg:"您已成功删除该设备联网设置！"
													// });
													layer.close(index);
													window.location.reload();
												}
											},
											error:function (res) {

											}
										})
									});
								}
							},
							{
								event: "link",
								layOpen:false,
								dataUrl:["eqSbbh","endPointIP","haspacs","hasworkbox","macrule","pmacid"],
								func:function(obj){
									var data = obj.data;
									var eqSbbh = data.eqSbbh;
									var macID= data.macID;
									var endPointIP = data.endPointIP;
									var haspacs = data.haspacs;
									var hasworkbox = data.hasworkbox;
									var macrule = data.macrule;
									var pmacid = data.pmacid;
									var html ="./edit1.html";
									var url = html + "?eqSbbh="+ eqSbbh + "&endPointIP=" + endPointIP;
									$(".edit").attr('href',url);
								}
							}
						]
					})
				}
			},
			reSet: {
				url: "/deviceparameter/show",
				type: "reload",
				data: ["macid", "bmId", "eqSbbh"],
			}
		},
	};
	renderMod.form = {
		date:{
			elem:"#date1",
			value:today0,
			type:"date",
			format:'yyyy-MM-dd',
			isInitValue:false
		},
		val: {
			filter: "forms",
			select: [
				{
					filter: "bmId",
					ids: "bmId",
					text: "bmName",
					url: "/supervise/bmgl/listBm"
				}
			]
		}
	};

</script>
</body>
</html>
