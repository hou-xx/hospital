<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>
    <title>配件请领（子）</title>
    <link rel="stylesheet" type="text/css" href="/static/admin/layui/css/layui.css"/>
    <link rel="stylesheet" type="text/css" href="/static/admin/css/admin.css"/>
    <script src="/static/admin/js/jquery-3.3.1.min.js"></script>
    <!--[if IE 8]>
    <script type="text/javascript" src="/static/admin/js/jquery-1.11.3.min.js"></script>
    <![endif]-->
    <script src="/static/admin/js/basic.js"></script>
    <style>
        .layui-form-label{
            padding: 8px 6px!important;
        }
        .layui-form-label{
            width:120px;
        }
        .layui-form-item{
            margin-bottom:30px;
        }
    </style>
</head>

<body>
<form class="layui-form layui-form-pane" action="" lay-filter="form">

    <div class="layui-row">
        <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
            <legend>直接维修</legend>
        </fieldset>

        <div class="col-xs-12 col-sm-6">

            <div class="layui-form-item">
                <label class="layui-form-label">维修工程师</label>
                <div class="layui-input-block">
                    <input type="text" disabled name="wxrName" class="layui-input" autocomplete="off" disabled>
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label">维修工时<span class="sign">*</span></label>
                <div class="layui-input-block">
                    <input type="text" name="wxsyTime" id="inputOne" class="layui-input" autocomplete="off" placeholder="请输入" lay-verify="required|number">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">维修费</label>
                <div class="layui-input-block">
                    <input type="text" name="wxPrice" class="layui-input" autocomplete="off" placeholder="请输入" lay-verify="required">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">辅助维修人员</label>
                <div class="layui-input-block">
                    <input type="text" name="fzwxId" class="layui-input" autocomplete="off" placeholder="请输入" lay-verify="required">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">维修结果</label>
                <div class="layui-input-block">
                    <select name="wxjg">
                        <option value="已修复工作正常">已修复工作正常</option>
                        <option value="部分修复尚需进一步维修">部分修复尚需进一步维修</option>
                        <option value="需外送维修">需外送维修</option>
                        <option value="无法维修">无法维修</option>
                    </select>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">工程师建议</label>
                <div class="layui-input-block">
                    <select name="gcsjy">
                        <option value="临床使用">临床使用</option>
                        <option value="停用">停用</option>
                        <option value="报废">报废</option>
                    </select>
                </div>
            </div>

        </div>

        <div class="col-xs-12 col-sm-6">

            <div class="layui-form-item">
                <label class="layui-form-label">故障原因类型<span class="sign">*</span></label>
                <div class="layui-input-block">
                    <select name="gzyyId" lay-filter="break_type">
                        <option value=""></option>
                        <option value="1">人为原因</option>
                        <option value="2">设备本身原因</option>
                        <option value="3">外界环境原因</option>
                        <option value="4">正常损耗原因</option>
                        <option value="5">其他不明原因</option>
                    </select>
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label">故障原因明细<span class="sign">*</span></label>
                <div class="layui-input-block">
                    <select name="gzmxId" id="gzmx" lay-filter="break_reason">
                        <option value=""></option>
                    </select>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">故障部位<span class="sign">*</span></label>
                <div class="layui-input-block">
                    <select  name="gzbwId" lay-filter="break_part">
                        <option value=""></option>
                    </select>
                </div>
            </div>
            <div class="layui-form-item" pane>
                <label class="layui-form-label">维修工作内容<span class="sign">*</span></label>
                <div class="layui-input-block">
                    <select name="wxgznr" lay-filter="repair_eng">
                        <option value="1">123</option>
                    </select>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label" style="width:120px">故障停机时长</label>
                <div class="layui-input-block" style="margin-left:120px;">
                    <input type="text" name="gztjTime" class="layui-input" autocomplete="off" lay-verify="required|number" placeholder="请输入（单位：小时）">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">服务开始时间</label>
                <div class="layui-input-block">
                    <input type="text" name="fwksTime" class="layui-input" autocomplete="off" id="date" lay-verify="required">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">排查完成时间</label>
                <div class="layui-input-block">
                    <input type="text" name="pcwcTime" class="layui-input" autocomplete="off" id="date1" lay-verify="required">
                </div>
            </div>

        </div>
    </div>

    <div class="layui-row">
        <div class="layui-form-item">
            <div class="layui-input-block">
                <button class="layui-btn" lay-submit id="save" lay-filter="demo1">确认数据</button>
            </div>
        </div>
    </div>
</form>

<script>
    formData = {};
    renderMod={
        form:{
            date:[
                {
                    elem:"#date",
                    value:today0+" "+time0,
                    type:"datetime",
                    format:'yyyy-MM-dd HH:mm:ss'
                },
                {
                    elem:"#date1",
                    value:today0+" "+time0,
                    type:"datetime",
                    format:'yyyy-MM-dd HH:mm:ss'
                }
            ],
            val:{
                filter:"form",
                get:{
                    url:"/fwWeixiu/pjqlWxIndex",
                    data:{
                        wxrId:$.getUrlParam("wxrId")
                    }
                }
            },
            event:{
                filter:"break_type",
                box:"select",
                func:function(data,val){
                    console.log(data);
                    subUp({
                        url:"/security/wxnr/wxnrZdIndex",
                        type:"GET",
                        data:{gzyyId:data.value,
                            gzmxId:$("#gzmx").val()
                        },
                        success:function(res){
                            if(res.code === 0){
                                var datt = res.data.list || res.data;
                                renderS(datt.gzyymx,"break_reason");
                                renderS(datt.gzbw,"break_part");
                                function renderS(d,f){
                                    //f => 需要渲染的select的lay-filter值
                                    var $d = $("select[lay-filter='"+f+"']");
                                    $d.html("");
                                    for (var i = 0; i < d.length; i++) {
                                        //console.log(d[i]);
                                        //动态渲染option标签并且渲染进页面
                                        $d .append($("<option>").attr({"value":d[i]['id']}).append(d[i]['wxnrzdText']));
                                    }
                                    layui.use("form",function(){
                                        var form = layui.form;
                                        //表单下拉单独重新渲染
                                        form.render("select");
                                    })

                                }
                            }
                        }
                    })
                }
            }
        },
        btn:{
            elem:"#save",
            func:function(){
                var $name = $.getUrlParam("vg")
                    ,$key = $.getUrlParam("key")
                    ,pData = {}
                    ,$input = $("input")
                    ,$select = $("select");
                //获取input标签的name与value，存入json
                for(var i=0;i<$input.length;i++){
                    pData[$input.eq(i).attr("name")] = $input.eq(i).val();
                }
                //获取select标签的name与value，存入json
                for(var j=0;j<$select.length;j++){
                    pData[$select.eq(j).attr("name")] = $select.eq(j).val();
                }
                //拼接数据
                pData["fzwxry"] = formData["fzwxry"];
                pData["wxzd"] = formData["wxzd"];
                pData["wxrId"] = $.getUrlParam("wxrId");
                pData["fwId"] = $.getUrlParam("fwId");
                layui.sessionData($name,{
                    key:$key,
                    value:pData
                });
                subUp({
                    url:"/fwWeixiu/jumpWx",
                    type:"POST",
                    data:pData
                });
                var index = parent.layer.getFrameIndex(window.name);
                parent.layer.close(index);
            }
        },
        bind:{
            selectItem:[
                {
                    elem:"#fzwx",
                    cb:"#",
                    db:"#",
                    key:"fzwxry",
                    name:"dtdt",
                    data:formData
                }
            ]
        }
    }
</script>
</body>

</html>