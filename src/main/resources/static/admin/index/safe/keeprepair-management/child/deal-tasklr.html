<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>
    <title>结果录入</title>
    <link rel="stylesheet" type="text/css" href="/static/admin/layui/css/layui.css"/>
    <link rel="stylesheet" type="text/css" href="/static/admin/css/admin.css"/>

    <script src="/static/admin/js/jquery-3.3.1.min.js"></script>
    <!--[if IE 8]>
    <script type="text/javascript" src="/static/admin/js/jquery-1.11.3.min.js"></script>
    <![endif]-->
    <script src="/static/admin/js/basic.js"></script>
</head>

<body>
<form class="layui-form layui-form-pane" action="" lay-filter="">
<fieldset class="layui-elem-field layui-field-title">
    <legend>结果录入</legend>
</fieldset>
<div class="layui-row col-xs-12 padRight">
    <div class="col-xs-12 col-sm-6">
        <div class="col-xs-12">
            <div class="layui-form-item">
                <label class="layui-form-label">维护结果<span class="sign">*</span></label>
                <div class="layui-input-block">
                    <input type="text" name="maintenanceResults" id="maintenanceResults" autocomplete="off"  class="layui-input" placeholder="请输入">
                </div>
            </div>
        </div>
        <div class="col-xs-12">
            <div class="layui-form-item">
                <label class="layui-form-label">仪器现状<span class="sign">*</span></label>
                <div class="layui-input-block">
                    <input type="text" name="instrumentStatus" id="instrumentStatus" autocomplete="off" lay-verify="required" placeholder="请输入"
                           class="layui-input">
                </div>
            </div>
        </div>

        <div class="col-xs-12">
            <div class="layui-form-item">
                <label class="layui-form-label">维护人员<span class="sign">*</span></label>
                <div class="layui-input-block">
                    <input type="text" name="maintenancePersonnel" id="maintenancePersonnel" autocomplete="off"  class="layui-input" placeholder="请输入">
                </div>
            </div>
        </div>
        <div class="col-xs-12">
            <div class="layui-form-item">
                <label class="layui-form-label">备注<span class="sign">*</span></label>
                <div class="layui-input-block">
                    <input type="text" name="description" id="description" placeholder="请输入" lay-verify="required" autocomplete="off"  class="layui-input">
                </div>
            </div>
        </div>
    </div>
    <div class="col-xs-12 col-sm-6">
    <div class="col-xs-12">
        <div class="layui-form-item">
            <label class="layui-form-label">检查日期<span class="sign">*</span></label>
            <div class="layui-input-block">
                <input type="text"  name="checkTime" id="checkTime" placeholder="请选择时间" autocomplete="off"  class="layui-input">
            </div>
        </div>
    </div>


    <div class="col-xs-12">
        <div class="layui-form-item">
            <label class="layui-form-label">完成日期<span class="sign">*</span></label>
            <div class="layui-input-block">
                <input type="text" name="dateOfCompletion" id="dateOfCompletion" placeholder="请选择时间" lay-verify="required" autocomplete="off"  class="layui-input">
            </div>
        </div>
    </div>
    <div class="col-xs-12">
    <div class="layui-form-item">
            <label class="layui-form-label">部门签收<span class="sign">*</span></label>
            <div class="layui-input-block">
                <button type="button" class="layui-btn layui-btn-fluid" id="test1" style="padding: 0;margin: 0">上传图片</button>
            </div>
        </div>
    </div>
    <div class="col-xs-12">
        <div class="layui-form-item">
            <div class="layui-upload-list" style="padding: 0;margin: 0">
                <img class="layui-upload-img" id="demo1" style="float: right; width: 110px;height: 50px;padding: 0;margin: 0">
                <p id="demoText"></p>
            </div>
        </div>
    </div>
    </div>

</div>
    <div>
        <div class="layui-colla-item">
            <div class="layui-colla-content layui-show">
                <div class="addBtn">
                    <button class="layui-btn layui-btn-sm addNew" data-id="table" lay-event="add" id="add" style="background: #003366"> <i class="layui-icon layui-icon-add-1"></i>新增</button>

                    <button class="layui-btn layui-btn-sm delNew" lay-event="del" id="del" style="background: #CC0033">  <i class="layui-icon layui-icon-delete"></i>删除</button>
                </div>
                <table id="table" lay-filter="table"></table>
            </div>
        </div>
    </div>
    <button class="layui-btn" lay-submit="" lay-filter="submit" >提交</button>
</form>
<script>
    layui.use('upload', function() {
        var $ = layui.jquery
            , upload = layui.upload;

        //普通图片上传
        var uploadInst = upload.render({
            elem: '#test1',
            url:"../upload"
            , before: function (obj) {
                //预读本地文件示例，不支持ie8
                console.log(img)
                obj.preview(function (index, file, result) {
                    $('#demo1').attr('src', result); //图片链接（base64）
                });
                localStorage.setItem("img",uploadInst);
                console.log(uploadInst)
            }
            , done: function (res) {
                //如果上传失败
                if (res.code > 0) {
                    return layer.msg('上传失败');
                }
                //上传成功
            }
            , error: function () {
                //演示失败状态，并实现重传
                var demoText = $('#demoText');
                demoText.html('<span style="color: #FF5722;">上传失败</span> <a class="layui-btn layui-btn-xs demo-reload">重试</a>');
                demoText.find('.demo-reload').on('click', function () {
                    uploadInst.upload();

                });
            }
        });

    })
</script>
<!--<script>-->
<!--    $("btnn").click(function(){-->
<!--        $.post("maintenance/resultAdd.do",-->
<!--            {-->
<!--                maintenanceId: document.getElementById("instrumentStatus").value,-->
<!--                maintenanceResults: document.getElementById("instrumentStatus").value,-->
<!--                instrumentStatus: document.getElementById("instrumentStatus").value,-->
<!--                description: document.getElementById("description").value,-->
<!--                maintenancePersonnel: document.getElementById("maintenancePersonnel").value,-->
<!--                checkTime: document.getElementById("checkTime").value,-->
<!--                departmentReceipt: document.getElementById("departmentReceipt").value,-->
<!--                dateOfCompletion: document.getElementById("dateOfCompletion").value,-->
<!--            },-->
<!--            function(data,status){-->
<!--                alert("数据: \n" + data + "\n状态: " + status);-->
<!--            });-->
<!--    });-->
<!--    </script>-->
    <script>
    var img = localStorage.getItem("img")
    localStorage.removeItem("img");

    var id = localStorage.getItem("dealId");
    renderMod = {
        bind: {
            addItem:[
                {
                    elem:"#add",
                    area: ['75%', '60%'],
                    base: "deal-add.html",
                    name: "vg",
                    key: "key",
                    func:function(obj,data){

                        // var a = localStorage.sitename;
                        // var tv = getTableValue("table");
                    },
                },
            ],
            delItem: ".delNew",
        },
        addTable: {
            table: {
                cols: [[ //表头
                    {type: "checkbox"}
                    ,{type: "numbers", title: '序号' }
                    , {field: 'productName', title: '名称', minWidth: 150}
                    , {field: 'cycle', title: '更换周期', minWidth: 100}
                    , {field: 'expired', title: '过期、更换', minWidth: 120}
                    , {field: 'notExpired', title: '未过期', minWidth: 100}
                    , {field: 'dateOfActivation', title: '起用日期', minWidth: 120}
                    , {field: 'changeDate', title: '更换日期', minWidth: 100}
                ]]
                , toolbar: false
                , page: false
                , height: "200"
                , data: []
                , text: {
                    none: "请点击上方按钮添加数据！"
                },
                done:function (res) {
                }
            }
        },
        formAction:{
            date: [{
                elem:"#dateOfCompletion",
                value: false,
                type:"date",
                format:"yyyy-MM-dd",
            },{
                elem:"#checkTime",
                value: false,
                type:"date",
                format:"yyyy-MM-dd",
            }],
            submit: {
                form: {
                    url: "/maintenance/resultAdd.do",
                    type: "POST",
                    data: ["maintenanceResults", "instrumentStatus", "description", "maintenancePersonnel", "checkTime", "departmentReceipt", "dateOfCompletion"],
                    add:{
                        maintenanceId:id

                    },
                    done:function () {
                        var index = parent.layer.getFrameIndex(window.name);
                        parent.layer.close(index); //再执行关闭
                        parent.location.reload();
                    }
                },
            }
        },
    }
</script>
</body>
</html>
