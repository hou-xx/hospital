<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>
    <title>规范编制</title>
    <link rel="stylesheet" type="text/css" href="/static/admin/layui/css/layui.css"/>
    <link rel="stylesheet" type="text/css" href="/static/admin/css/admin.css"/>

    <script src="/static/admin/js/jquery-3.3.1.min.js"></script>
    <!--[if IE 8]>
    <script type="text/javascript" src="/static/admin/js/jquery-1.11.3.min.js"></script>
    <![endif]-->
    <script src="/static/admin/js/basic.js"></script>
    <style>
        .layui-inline{
            width:140px;
        }
    </style>
</head>

<body>

<div class="layui-row col-xs-12 padRight">
    <fieldset class="layui-elem-field layui-field-title">
        <legend>规范制定</legend>
    </fieldset>
    <form class="layui-form layui-form-pane" action="" lay-filter="forms">
        <div class="col-xs-6">
            <div class="layui-form-item">
                <label class="layui-form-label">设备<span class="sign">*</span></label>
                <div class="layui-input-block">
                    <input type="hidden" name="eqId" disabled class="layui-input eqId" id="eqIdName">
                    <input type="text" placeholder="请选择" lay-verify="required" autocomplete="off" disabled class="layui-input " id="eqId"
                           style="padding-left:60px;">
                    <button class="layui-btn layui-btn-normal layui-btn-sm PoAb0xx0" lay-filter="selectUsera" id="selectUsera">选择</button>
                </div>
            </div>
        </div>
        <div class="col-xs-6">
            <div class="layui-form-item">
                <label class="layui-form-label">适用设备</label>
                <div class="layui-input-block">
                    <select name="applicable_eq" id="applicable_eq">
                        <option>同厂家同型号</option>
                        <option>同类设备</option>
                        <option>同简称设备</option>
                        <option>按科室</option>
                        <option>全部设备</option>
                    </select>
                </div>
            </div>
        </div>
        <div class="col-xs-6">
            <div class="layui-form-item">
                <label class="layui-form-label">制定人<span class="sign">*</span></label>
                <div class="layui-input-block">
                    <input type="text" name="formulator" id="formulator" disabled="disabled" autocomplete="off" lay-verify="required" placeholder="请输入"
                           class="layui-input">
                </div>
            </div>
        </div>
        <div class="col-xs-6">
            <div class="layui-form-item">
                <label class="layui-form-label">审核人<span class="sign">*</span></label>
                <div class="layui-input-block">
                    <input type="text" name="reviewer" id="reviewer" placeholder="请选择" lay-verify="required" autocomplete="off" disabled class="layui-input"
                           style="padding-left:60px;">
                    <button class="layui-btn layui-btn-normal layui-btn-sm PoAb0xx0" id="selectUser">选择</button>
                </div>
            </div>
        </div>
        <div class="col-xs-6">
            <div class="layui-form-item">
                <label class="layui-form-label">制定时间<span class="sign">*</span></label>
                <div class="layui-input-block">
                    <input type="text" id="formTime" name="formTime" autocomplete="off" lay-verify="required" placeholder="请输入"
                           class="layui-input">
                </div>
            </div>
        </div>
        <div class="col-xs-6">
            <div class="layui-form-item">
                <label class="layui-form-label">周期<span class="sign">*</span></label>
                <div class="layui-input-block">
                    <input type="text" id="cycle" autocomplete="off" lay-verify="required" placeholder="请输入"
                           class="layui-input">
                </div>
            </div>
        </div>
        <div class="col-xs-6">
            <div class="layui-form-item">
                <label class="layui-form-label">周期规则</label>
                <div class="layui-input-block">
                    <select name="cycleRule" id="cycleRule">
                        <option>按风险值估算</option>
                        <option>按厂家规定</option>
                    </select>
                </div>
            </div>
        </div>

    </form>
</div>
    <div>
        <div class="layui-colla-item">
            <div class="layui-colla-content layui-show">
                <div class="addBtn">
                    <button class="layui-btn layui-btn-sm addNew" data-id="table" lay-event="add" id="add" style="background: #003366"> <i class="layui-icon layui-icon-add-1"></i>新增</button>

                    <button class="layui-btn layui-btn-sm delNew" lay-event="del" id="del" style="background: #CC0033">  <i class="layui-icon layui-icon-delete"></i>删除</button>
                </div>
                <table id="table" lay-filter="table"></table>
            </div>
        </div>
    </div>
    <button class="warm_btn layui-btn layui-btn-warm layui-btn-fluid" lay-submit="" id="btnn" lay-filter="btnn">提交</button>
</div>
<script>
    var formData2 = {};
    var projectList = [], tm = "";
    var emp = tempValue("rl", "emp", false);

    $(function(){
        $("[name='formulator']").val(emp.userXm);
    });
    renderMod = {
        addTable: {
            table: {
                cols: [[ //表头
                    {type: "checkbox"}
                    ,{type: "numbers", title: '序号' }
                    , {field: 'projectType', title: '项目类型', minWidth: 150}
                    , {field: 'projectName', title: '项目名称', minWidth: 150}
                    , {field: 'projectLevel', title: '级别', minWidth: 100}
                    , {field: 'cycle', title: '周期', minWidth: 120}
                    , {field: 'cycleUnit', title: '周期单位', minWidth: 100}
                    , {field: 'implementerType', title: '实施人类型', minWidth: 120}
                    , {field: 'firstTime', title: '首次实施', minWidth: 100}
                ]]
                , toolbar: false
                , page: false
                , height: "200"
                , data: []
                , text: {
                    none: "请点击上方按钮添加数据！"
                },
                done:function (res) {
                    var ty = localStorage.getItem("fa");
                    tm =ty;
                    localStorage.removeItem("fa");
                    projectList.push(tm);
                   console.log(projectList);
                    $("#del").off("click").on("click",function(){

                        var checkedArr = [];
                        for (var i = 0; i < table.cache.table.length; i++) {
                            if (table.cache.table[i].LAY_CHECKED == true){
                                checkedArr.push(i);
                            }
                        }
                        var eqSbbhs =[];
                        for (var i = 0; i < checkedArr.length; i++){
                            var t = checkedArr[i];
                            eqSbbhs.push(table.cache.table[t].id);
                        }
                        checkedArr.length = 0;//清除数组
                      /*  $.ajax({
                            url:'/inspection/otherfunction/updateEqSbbh1',
                            type:"POST",
                            async: false,/!*同步传输*!/
                            data:JSON.stringify(eqSbbhs),
                            dataType:'JSON',
                            contentType:'application/json'

                        })*/
                    });
                }
            }
        },
        bind: {
            selectItem: [
                {
                    elem: "#selectUser",
                    cb: "/kwgl/empgl/listSelectEmpsCols",
                    db: "/kwgl/empgl/listSelectEmps",
                    name: "dtdt",
                    na:"userXm",
                    key: "radio",
                    data: formData2,
                    assign_el_name:'reviewer',
                    se:"/kwgl/empgl/empSe"
                },
            ],
            addItem:[
                {
                    elem:"#add",
                    area: ['75%', '60%'],
                    base: "./child/standard-add.html",
                    name: "vg",
                    key: "key",
                    before:function(){
                        var a = localStorage.sitename;
                        var tv = getTableValue("table");
                    },
                },
            ],
            delItem: ".delNew",
        },
        form: {
            date: {
                elem:"#formTime",
                isInitValue: false,
                type:"date",
                format:"yyyy-MM-dd",
            },
            submit:{
                filter:"btnn",//可以不写

                func:function (obj,data) {

                    console.log("ids = " + localStorage.getItem("projectsIds").toString());
                    $.post("http://localhost:8080/maintenance/addMaintenance.do",
                        {
                            eqId:document.getElementById("eqIdName").value,
                            applicable_eq:document.getElementById("applicable_eq").value,
                            formulator:document.getElementById("formulator").value,
                            reviewer:document.getElementById("reviewer").value,
                            formTime:document.getElementById("formTime").value,
                            cycleRule:document.getElementById("cycleRule").value,
                            cycle:document.getElementById("cycle").value,
                            projectList:localStorage.getItem("projectsIds").toString(),
                            ifNotRisk:false,
                        },
                        function(data,status){
                            localStorage.removeItem("projectsIds")
                        });
                }
                // form:{//或者写作up
                //     url: "/maintenance/addMaintenance.do",
                //     type: "POST",
                //     data: [
                //         "eqId","applicable_eq","formulator","reviewer", "formTime", "cycleRule",
                //     ],
                //     param:["projectList"],
                //     reload: true,
                // },
                // before:function(data){
                //     layui.use(['table'], function(){
                //         var  layer = layui.layer
                //             ,table = layui.table;
                //         layui.layer.open({
                //             type: 0
                //             ,title: '提示'
                //             ,area: ['20%', '20%']
                //             ,shade: 0.3
                //             ,content: '是够同步风险值'
                //             ,btn: ['是', '否']
                //             ,yes: function(){
                //                 // alert(123)
                //             }
                //             ,btn2: function(){
                //             }
                //         });
                //     })
                // },
                }//表单提交后执行函数（不论成功与否）
            },
        btn:[
            {
                elem:"#selectUsera",
                type:"click",
                func:function(){
                    layui.use(['table'], function(){
                        var  layer = layui.layer
                            ,table = layui.table;
                            layui.layer.open({
                                type: 2,
                                title: '设备名',
                                shadeClose: true,
                                area: ['90%', '90%'],
                                content: './child/s1.html'
                            });
                    })
                }
            }
        ]
    }
</script>
</body>

</html>
