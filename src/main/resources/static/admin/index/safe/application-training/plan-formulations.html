<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="renderer" content="webkit">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport"
          content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no"/>
    <title>计划制定</title>
    <link rel="stylesheet" type="text/css" href="../../../../static/admin/layui/css/layui.css"/>
    <link rel="stylesheet" type="text/css" href="../../../../static/admin/css/admin.css"/>
    <link rel="stylesheet" href="../../../../static/admin/css/all.min.css"/>
    <script src="../../../../static/admin/js/jquery-3.3.1.min.js"></script>
    <!--[if IE 8]>
    <script type="text/javascript" src="../../../../static/admin/js/jquery-1.11.3.min.js"></script>
    <![endif]-->
    <script src="../../../../static/admin/js/basic.js"></script>
    <style>
        .layui-form-label {
            width: 145px !important;
        }

        .layui-input-block {
            margin-left: 145px !important;
        }

        .layui-form-text .layui-form-label {
            width: 100% !important;
        }

        .layui-form-text .layui-input-block {
            margin-left: 0 !important;
        }
    </style>
</head>

<body>
<form class="layui-form layui-form-pane">
    <div class="layui-row">
        <!--        <fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
            <legend>医疗器械生产/经营许可证验证</legend>
        </fieldset>-->
        <div class="col-xs-12 col-sm-6">
            <div class="layui-form-item ">
                <label class="layui-form-label">设备选择<span
                        class="sign">*</span></label>
                <div class="layui-input-block">
                    <input type="text" name="eqName" disabled id="eqName" class="layui-input col-sm-7">
                    <input type="hidden" id="eqId">
                    <button class="layui-btn col-sm-2" style="margin: 0;margin-right: 1px"
                            id="selectEmp" lay-filter="sub">选择
                    </button>
                    <button class="layui-btn col-sm-2" style="margin: 0"
                            id="put" lay-filter="sub">导入信息
                    </button>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">院内编码<span class="sign">*</span></label>
                <div class="layui-input-block">
                    <input type="text"  id="eqZcbh" autocomplete="" class="layui-input" disabled>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">培训科室<span class="sign">*</span></label>
                <div class="layui-input-block">
                    <input type="hidden" id="bmId">
                    <input type="text" name="pxks" disabled id="pxks" class="layui-input col-sm-10">
                    <button class="layui-btn col-sm-2" style="margin: 0;"
                            id="selectEmps" lay-filter="sub">选择
                    </button>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">培训方式<span class="sign">*</span></label>
                <div class="layui-input-block">
                    <select name="pxfs">
                        <option value="科内培训">科内培训</option>
                        <option value="院内培训">院内培训</option>
                        <option value="院外培训">院外培训</option>
                    </select>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">开始日期<span class="sign">*</span></label>
                <div class="layui-input-block">
                    <input type="text" name="kstime" autocomplete="" id="date1" class="layui-input"
                           lay-verify="required">
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">结束日期<span class="sign">*</span></label>
                <div class="layui-input-block">
                    <input type="text" name="jstime" autocomplete="" id="date2" class="layui-input"
                           lay-verify="required">
                </div>
            </div>
        </div>

        <div class="col-xs-12 col-sm-6">
            <div class="layui-form-item">
                <label class="layui-form-label">培训编号</label>
                <div class="layui-input-block">
                    <input type="text" name="pxbh" id="pxbh" class="layui-input" disabled>
                </div>
            </div>

            <div class="layui-form-item">
                <label class="layui-form-label">分类编码<span class="sign">*</span></label>
                <div class="layui-input-block">
                    <input type="text"  id="eqSbbh" class="layui-input" disabled>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">培训类型<span class="sign">*</span></label>
                <div class="layui-input-block">
                    <select name="pxlx">
                        <option value="新产品新技术规范化培训">新产品新技术规范化培训</option>
                        <option value="临床验收培训">临床验收培训</option>
                        <option value="使用过程中培训">使用过程中培训</option>
                    </select>
                </div>
            </div>
            <div class="layui-form-item">
                <label class="layui-form-label">培训内容类别<span class="sign">*</span></label>
                <div class="layui-input-block" id="sa">
                    <input type="checkbox" name="pxnrlb" value="节能减排" title="节能减排">
                    <input type="checkbox" name="pxnrlb" value="岗位职责" title="岗位职责" checked>
                    <input type="checkbox" name="pxnrlb" value="临床使用安全" title="临床使用安全">
                    <input type="checkbox" name="pxnrlb" value="应急管理" title="应急管理">
                    <input type="checkbox" name="pxnrlb" value="安全生产" title="安全生产">
                    <input type="checkbox" name="pxnrlb" value="其他培训" title="其他培训">
                </div>
            </div>
        </div>
    </div>
    <div class="layui-row">
        <div class="col-xs-12 col-sm-12">
            <div class="layui-form-item layui-form-text">
                <label class="layui-form-label">培训内容</label>
                <div class="layui-input-block">
                    <textarea type="text" name="pxnr" class="layui-textarea" autocomplete="off"></textarea>
                </div>
            </div>
        </div>
    </div>
    <div class="layui-row">
        <div class="layui-form-item" style="float: right;margin-right: 20%;">
            <div class="layui-input-block">
                <button class="layui-btn" lay-submit="" lay-filter="sub">保存</button>
            </div>
        </div>
    </div>
</form>
<div id="tips">

</div>

<script>
    var formData={};
    var formData2={};
    $('#put').on('click', function () {
        $("#eqZcbh").val(formData2.radio[0]["eqZcbh"]);
        $("#eqSbbh").val(formData2.radio[0]["eqSbbh"]);
        $("#eqId").val(formData2.radio[0]["eqId"]);
    });
    renderMod = {
        bind: {
            selectItem: [
                {
                    elem: "#selectEmp",
                    // cb: "/lifeManage/listHtBiaotou",
                    cb: "/px/getYypxBt",
                    // db: "/cs/listScs",
                    db: "/px/getYypxNr",
                    name: "dtdt",
                    key: "radio",
                    data: formData2,
                    func:function(res){
                        console.log(123);
                    }
                },
                {
                    elem: "#selectEmps",
                    // cb: "/lifeManage/listHtBiaotou",
                    cb: "/px/getBmBt",
                    // db: "/cs/listScs",
                    db: "/px/getYypxKsNr",
                    name: "dtdt",
                    key: "radio",
                    data: formData
                }

            ]
        },
        form: {
            val: {
                filter: "forms",
                get: {
                    url: "/px/getNum",
                    type: "POST"
                },
                func: function (res) {
                    $("#pxbh").val(res);
                }
            },
            date: [
                {
                    elem: "#date1",
                    value: today0,
                    type: "date",
                    format: 'yyyy-MM-dd'
                },
                {
                    elem: "#date2",
                    value: today0,
                    type: "date",
                    format: 'yyyy-MM-dd'
                }
            ],
            submit: {
                before: function (param) {
                    var a=$("#eqId").val();
                    var b=$("#eqZcbh").val();
                    var c=$("#eqSbbh").val();
                    $("#bmId").val(formData.radio[0]["bmId"]);
                    var d=$("#bmId").val();
                    console.log(d);
                    var arr=[];
                    $("#sa input:checkbox[name='pxnrlb']:checked").each(function(i){
                        arr[i]=$(this).val();
                    });
                    arr.join(',');
                    return param = {
                        1: arr.join(','),
                        2: a,
                        3: b,
                        4: c,
                        5: d
                    };
                },
                form: {
                    url: "/px/addYypxjh",
                    type: "POST",
                    data: ["eqId",  "pxks", "pxfs", "kstime", "jstime", "pxbh",
                        "pxlx","pxnr"],
                    contentType: "application/json",
                    param: {
                        1: "pxnrlb",
                        2: "eqId",
                        3: "eqZcbh",
                        4: "eqSbbh",
                        5: "ksId"
                    },
                    success: function (res) {
                        window.location.href = "/admin/index/safe/application-training/plan-query.html"
                    },
                    error: function (r) {
                        layer.alert("error");
                    }
                }
            }
        }
    }
</script>
</body>

</html>